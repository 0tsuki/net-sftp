<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Net::SFTP::Operations::Upload</title>
    <meta content='text/html; charset=US-ASCII' http-equiv='Content-Type'>
    <link href='../../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Net::SFTP::Operations::Upload
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../../../files/lib/net/sftp/operations/upload_rb.html">lib/net/sftp/operations/upload.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Operations.html">Operations</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>A general purpose uploader module for <a
            href="../../SFTP.html">Net::SFTP</a>. It can upload IO objects, files, and
            even entire directory trees via <a href="../../SFTP.html">SFTP</a>, and
            provides a flexible progress reporting mechanism.</p>
            
            <p>To upload a single file to the remote server, simply specify both the local
            and remote paths:</p>
            
            <pre>uploader = sftp.upload(&quot;/path/to/local.txt&quot;, &quot;/path/to/remote.txt&quot;)</pre>
            
            <p>By default, this operates asynchronously, so if you want to block until the
            upload finishes, you can use the 'bang' variant:</p>
            
            <pre>sftp.upload!(&quot;/path/to/local.txt&quot;, &quot;/path/to/remote.txt&quot;)</pre>
            
            <p>Or, if you have multiple uploads that you want to run in parallel, you can
            employ the <a href="Upload.html#method-i-wait">wait</a> method of the
            returned object:</p>
            
            <pre class="ruby"><span class="ruby-identifier">uploads</span> = <span class="ruby-node">%w(file1 file2 file3)</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">f</span>, <span class="ruby-node">&quot;remote/#{f}&quot;</span>) }&#x000A;<span class="ruby-identifier">uploads</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">wait</span> }</pre>
            
            <p>To upload an entire directory tree, recursively, simply pass the directory
            path as the first parameter:</p>
            
            <pre>sftp.upload!(&quot;/path/to/directory&quot;, &quot;/path/to/remote&quot;)</pre>
            
            <p>This will upload "/path/to/directory", it's contents, it's subdirectories,
            and their contents, recursively, to "/path/to/remote" on the remote server.</p>
            
            <p>For uploading a directory without creating it, do
            sftp.upload!("/path/to/directory", "/path/to/remote", :mkdir =&gt; false)</p>
            
            <p>If you want to send data to a file on the remote server, but the data is in
            memory, you can pass an IO object and upload it's contents:</p>
            
            <pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">'stringio'</span>&#x000A;<span class="ruby-identifier">io</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">data</span>)&#x000A;<span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">upload!</span>(<span class="ruby-identifier">io</span>, <span class="ruby-string">&quot;/path/to/remote&quot;</span>)</pre>
            
            <p>The following options are supported:</p>
            <ul><li>
            <p><code>:progress</code> - either a block or an object to act as a progress
            callback. See the discussion of "progress monitoring" below.</p>
            </li><li>
            <p><code>:requests</code> - the number of pending <a
            href="../../SFTP.html">SFTP</a> requests to allow at any given time. When
            uploading an entire directory tree recursively, this will default to 16,
            otherwise it will default to 2. Setting this higher might improve
            throughput. Reducing it will reduce throughput.</p>
            </li><li>
            <p><code>:read_size</code> - the maximum number of bytes to read at a time
            from the source. Increasing this value might improve throughput. It
            defaults to 32,000 bytes.</p>
            </li><li>
            <p><code>:name</code> - the filename to report to the progress monitor when an
            IO object is given as <code>local</code>. This defaults to
            "&lt;memory&gt;".</p>
            </li></ul>
            
            <h2 id="label-Progress+Monitoring">Progress Monitoring</h2>
            
            <p>Sometimes it is desirable to track the progress of an upload. There are two
            ways to do this: either using a callback block, or a special custom object.</p>
            
            <p>Using a block it's pretty straightforward:</p>
            
            <pre class="ruby"><span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">upload!</span>(<span class="ruby-string">&quot;local&quot;</span>, <span class="ruby-string">&quot;remote&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span>, <span class="ruby-identifier">uploader</span>, *<span class="ruby-identifier">args</span><span class="ruby-operator">|</span>&#x000A;  <span class="ruby-keyword">case</span> <span class="ruby-identifier">event</span>&#x000A;  <span class="ruby-keyword">when</span> :<span class="ruby-identifier">open</span> <span class="ruby-keyword">then</span>&#x000A;    <span class="ruby-comment"># args[0] : file metadata</span>&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;starting upload: #{args[0].local} -&gt; #{args[0].remote} (#{args[0].size} bytes}&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> :<span class="ruby-identifier">put</span> <span class="ruby-keyword">then</span>&#x000A;    <span class="ruby-comment"># args[0] : file metadata</span>&#x000A;    <span class="ruby-comment"># args[1] : byte offset in remote file</span>&#x000A;    <span class="ruby-comment"># args[2] : data being written (as string)</span>&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;writing #{args[2].length} bytes to #{args[0].remote} starting at #{args[1]}&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> :<span class="ruby-identifier">close</span> <span class="ruby-keyword">then</span>&#x000A;    <span class="ruby-comment"># args[0] : file metadata</span>&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;finished with #{args[0].remote}&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> :<span class="ruby-identifier">mkdir</span> <span class="ruby-keyword">then</span>&#x000A;    <span class="ruby-comment"># args[0] : remote path name</span>&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;creating directory #{args[0]}&quot;</span>&#x000A;  <span class="ruby-keyword">when</span> :<span class="ruby-identifier">finish</span> <span class="ruby-keyword">then</span>&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;all done!&quot;</span>&#x000A;<span class="ruby-keyword">end</span></pre>
            
            <p>However, for more complex implementations (e.g., GUI interfaces and such) a
            block can become cumbersome. In those cases, you can create custom handler
            objects that respond to certain methods, and then pass your handler to the
            uploader:</p>
            
            <pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">CustomHandler</span>&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">on_open</span>(<span class="ruby-identifier">uploader</span>, <span class="ruby-identifier">file</span>)&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;starting upload: #{file.local} -&gt; #{file.remote} (#{file.size} bytes)&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">on_put</span>(<span class="ruby-identifier">uploader</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">data</span>)&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;writing #{data.length} bytes to #{file.remote} starting at #{offset}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">on_close</span>(<span class="ruby-identifier">uploader</span>, <span class="ruby-identifier">file</span>)&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;finished with #{file.remote}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">on_mkdir</span>(<span class="ruby-identifier">uploader</span>, <span class="ruby-identifier">path</span>)&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;creating directory #{path}&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;&#x000A;  <span class="ruby-keyword">def</span> <span class="ruby-identifier">on_finish</span>(<span class="ruby-identifier">uploader</span>)&#x000A;    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;all done!&quot;</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;<span class="ruby-keyword">end</span>&#x000A;&#x000A;<span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">upload!</span>(<span class="ruby-string">&quot;local&quot;</span>, <span class="ruby-string">&quot;remote&quot;</span>, :<span class="ruby-identifier">progress</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">CustomHandler</span>.<span class="ruby-identifier">new</span>)</pre>
            
            <p>If you omit any of those methods, the progress updates for those missing
            events will be ignored. You can create a catchall method named "call" for
            those, instead.</p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-5B-5D">[]</a></li>
              <li><a target="docwin" href="#method-i-5B-5D-3D">[]=</a></li>
              <li><a target="docwin" href="#method-i-abort-21">abort!</a></li>
              <li><a target="docwin" href="#method-i-active-3F">active?</a></li>
              <li><a target="docwin" href="#attribute-i-local">local</a></li>
              <li><a target="docwin" href="#attribute-i-options">options</a></li>
              <li><a target="docwin" href="#attribute-i-properties">properties</a></li>
              <li><a target="docwin" href="#method-i-recursive-3F">recursive?</a></li>
              <li><a target="docwin" href="#attribute-i-remote">remote</a></li>
              <li><a target="docwin" href="#attribute-i-sftp">sftp</a></li>
              <li><a target="docwin" href="#method-i-wait">wait</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li>Net::SSH::Loggable</li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>DEFAULT_READ_SIZE</td>
                    <td>=</td>
                    <td class='context-item-value'>32_000</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>The default # of bytes to read from disk at a time.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>LiveFile</td>
                    <td>=</td>
                    <td class='context-item-value'>Struct.new(:local, :remote, :io, :size, :handle)</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>A simple struct for recording metadata about the file currently being
                      uploaded.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>RECURSIVE_READERS</td>
                    <td>=</td>
                    <td class='context-item-value'>16</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>The number of readers to use when uploading a directory.</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>SINGLE_FILE_READERS</td>
                    <td>=</td>
                    <td class='context-item-value'>2</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      <p>The number of readers to use when uploading a single file.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-local'>local</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The source of the upload (on the local server)</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-options'>options</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The hash of options that were given when the object was instantiated</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-properties'>properties</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The properties hash for this object</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-remote'>remote</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The destination of the upload (on the remote server)</p>
                    </td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>
                      <a name='attribute-i-sftp'>sftp</a>
                    </td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <p>The <a href="../../SFTP.html">SFTP</a> session object used by this upload
                      instance</p>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-5B-5D'>
                <a name='method-i-5B-5D'></a>
                <div class='synopsis'>
                  <span class='name'>[]</span>
                  <span class='arguments'>(name)</span>
                </div>
                <div class='description'>
                  
                  <p>Returns the property with the given name. This allows <a
                  href="Upload.html">Upload</a> instances to store their own state when used
                  as part of a state machine.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-5B-5D-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-5B-5D-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 209</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">name</span>)&#x000A;  <span class="ruby-ivar">@properties</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>]&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-5B-5D-3D'>
                <a name='method-i-5B-5D-3D'></a>
                <div class='synopsis'>
                  <span class='name'>[]=</span>
                  <span class='arguments'>(name, value)</span>
                </div>
                <div class='description'>
                  
                  <p>Sets the given property to the given name. This allows <a
                  href="Upload.html">Upload</a> instances to store their own state when used
                  as part of a state machine.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-5B-5D-3D-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-5B-5D-3D-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 215</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)&#x000A;  <span class="ruby-ivar">@properties</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-identifier">value</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-abort-21'>
                <a name='method-i-abort-21'></a>
                <div class='synopsis'>
                  <span class='name'>abort!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Forces the transfer to stop.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-abort-21-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-abort-21-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 195</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">abort!</span>&#x000A;  <span class="ruby-ivar">@active</span> = <span class="ruby-value">0</span>&#x000A;  <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">clear</span>&#x000A;  <span class="ruby-ivar">@uploads</span>.<span class="ruby-identifier">clear</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-active-3F'>
                <a name='method-i-active-3F'></a>
                <div class='synopsis'>
                  <span class='name'>active?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns true if the uploader is currently running. When this is false, the
                  uploader has finished processing.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-active-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-active-3F-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 190</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">active?</span>&#x000A;  <span class="ruby-ivar">@active</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@stack</span>.<span class="ruby-identifier">any?</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-recursive-3F'>
                <a name='method-i-recursive-3F'></a>
                <div class='synopsis'>
                  <span class='name'>recursive?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Returns true if a directory tree is being uploaded, and false if only a
                  single file is being uploaded.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-recursive-3F-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-recursive-3F-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 184</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">recursive?</span>&#x000A;  <span class="ruby-ivar">@recursive</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-method-i-wait'>
                <a name='method-i-wait'></a>
                <div class='synopsis'>
                  <span class='name'>wait</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  
                  <p>Blocks until the upload has completed.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-wait-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-wait-source'><span class="ruby-comment"># File lib/net/sftp/operations/upload.rb, line 202</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">wait</span>&#x000A;  <span class="ruby-identifier">sftp</span>.<span class="ruby-identifier">loop</span> { <span class="ruby-identifier">active?</span> }&#x000A;  <span class="ruby-keyword">self</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
